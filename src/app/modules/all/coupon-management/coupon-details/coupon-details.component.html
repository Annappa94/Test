<div class="bg-white rounded mb-4 d-flex align-items-center py-2 sticky-header justify-content-between">
  <ul id="breadcrumbs" *ngIf="couponDetails">
    <li><span style="cursor: pointer;" class="hover-item" (click)="goBack()">All Coupons</span></li>
    <li><span>{{couponDetails?.couponCode}}</span></li>
  </ul>
  <div>
    <app-back-button></app-back-button>
  </div>
</div>

<div class="row">
  <div class="col-lg-4 mt-4">

    <div class="card card-custom gutter-b" *ngIf="couponDetails">
      <div class="card-body pt-4">
        <div class="d-flex justify-content-between align-items-baseline">
          <div class="font-size-h5 mb-3 font-weight-bolder text-success">
            {{couponDetails?.couponCode}}
          </div>
        </div>
        <p class="mb-4">
          <span class="text-success font-weight-bold pr-1">Details</span>
        </p>
        <div class="mb-7">
          <div class="d-flex justify-content-between align-items-cente my-2">
            <span class="text-muted font-weight-bold mr-2">Category:</span>
            <span class="text-dark-75 font-weight-bold">{{couponDetails?.category}}</span>
          </div>

          <div class="d-flex justify-content-between align-items-cente my-2">
            <span class="text-muted font-weight-bold mr-2">Applicable for:</span>
            <span class="text-dark-75 font-weight-bold" 
                *ngFor="let customer of couponDetails?.applicableFor; let i=index">
                {{customer}} <span *ngIf="i != couponDetails?.applicableFor?.length - 1">, </span>
              </span>
          </div>
          
          <div class="d-flex justify-content-between align-items-cente my-2" *ngIf="couponDetails?.category=='ADVANCED'">
            <span class="text-muted font-weight-bold mr-2">Target:</span>
            <span class="text-dark-75 font-weight-bold">{{couponDetails?.advancedConfiguration?.target}}</span>
          </div>

          <div class="d-flex justify-content-between align-items-cente my-2">
            <span class="text-muted font-weight-bold mr-2">Description:</span>
            <span class="text-dark-75 font-weight-bold">{{couponDetails?.description}}</span>
          </div>

          <div class="d-flex justify-content-between align-items-cente my-2">
            <span class="text-muted font-weight-bold mr-2">Created Date:</span>
            <span class="text-dark-75 font-weight-bold">{{utils.getDisplayTime(couponDetails?.createdDate)}}</span>
          </div>

          <div class="d-flex justify-content-between align-items-cente my-2">
            <span class="text-muted font-weight-bold mr-2">Created by:</span>
            <span class="text-dark-75 font-weight-bold">{{couponDetails?.createdBy}}</span>
          </div>

          <div class="d-flex justify-content-between align-items-cente my-2">
            <span class="text-muted font-weight-bold mr-2">Created Date:</span>
            <span class="text-dark-75 font-weight-bold">{{utils.getDisplayTime(couponDetails?.createdDate)}}</span>
          </div>

          <div class="d-flex justify-content-between align-items-cente my-2">
            <span class="text-muted font-weight-bold mr-2">Updated Date:</span>
            <span class="text-dark-75 font-weight-bold">{{utils.getDisplayTime(couponDetails?.lastModifiedDate)}}</span>
          </div>

          <div class="d-flex justify-content-between align-items-cente my-2">
            <span class="text-muted font-weight-bold mr-2">Updated by:</span>
            <span class="text-dark-75 font-weight-bold">{{couponDetails?.lastModifiedBy}}</span>
          </div>

          <div class="d-flex justify-content-between align-items-cente my-2">
            <span class="text-muted font-weight-bold mr-2">Type:</span>
            <span class="text-dark-75 font-weight-bold">{{couponDetails?.type}}</span>
          </div>
          
          <div class="d-flex justify-content-between align-items-cente my-2">
            <span class="text-muted font-weight-bold mr-2">Value:</span>
            <span class="text-dark-75 font-weight-bold">
              <span *ngIf="couponDetails?.type=='FIXED'">Rs. </span>{{couponDetails?.value.toLocaleString('en-IN')}}<span
                *ngIf="couponDetails?.type!='FIXED'">%</span></span>
          </div>
          <div class="d-flex justify-content-between align-items-cente my-2">
            <span class="text-muted font-weight-bold mr-2">Active:</span>
            <span class="text-dark-75 font-weight-bold">{{couponDetails?.isActive ? 'Yes' : 'No'}}</span>
          </div>

          <div class="d-flex justify-content-between align-items-cente my-2">
            <span class="text-muted font-weight-bold mr-2">Active from:</span>
            <span class="text-dark-75 font-weight-bold">{{utils.getDisplayTime(couponDetails?.fromDate)}}</span>
          </div>

          <div class="d-flex justify-content-between align-items-cente my-2">
            <span class="text-muted font-weight-bold mr-2">Active till:</span>
            <span class="text-dark-75 font-weight-bold">{{utils.getDisplayTime(couponDetails?.toDate)}}</span>
          </div>

          <div class="d-flex justify-content-between align-items-cente my-2" *ngIf="couponDetails?.minTransactionAmount">
            <span class="text-muted font-weight-bold mr-2">Min Transaction Amount:</span>
            <span class="text-dark-75 font-weight-bold">Rs. {{couponDetails?.minTransactionAmount.toLocaleString('en-IN')}}</span>
          </div>

          <div class="d-flex justify-content-between align-items-cente my-2" *ngIf="couponDetails?.noOfTimesCanBeUsedPerCustomer">
            <span class="text-muted font-weight-bold mr-2">Max usage per customer:</span>
            <span class="text-dark-75 font-weight-bold">{{couponDetails?.noOfTimesCanBeUsedPerCustomer}}</span>
          </div>

          <div class="d-flex justify-content-between align-items-cente my-2" *ngIf="couponDetails?.noOfTimesCanBeUsedTotal">
            <span class="text-muted font-weight-bold mr-2">Max usage:</span>
            <span class="text-dark-75 font-weight-bold">{{couponDetails?.noOfTimesCanBeUsedTotal.toLocaleString('en-IN')}}</span>
          </div>

          <div class="d-flex justify-content-between align-items-cente my-2" *ngIf="couponDetails?.couponUsedNoOfTimes">
            <span class="text-muted font-weight-bold mr-2">Coupon used number of times:</span>
            <span class="text-dark-75 font-weight-bold">{{couponDetails?.couponUsedNoOfTimes.toLocaleString('en-IN')}}</span>
          </div>

          <div class="d-flex justify-content-between align-items-cente my-2" *ngIf="couponDetails?.totalUsageValue">
            <span class="text-muted font-weight-bold mr-2">Total Usage Value:</span>
            <span class="text-dark-75 font-weight-bold">{{couponDetails?.totalUsageValue.toLocaleString('en-IN')}}</span>
          </div>

        </div>

        <p class="text-success" *ngIf="couponDetails.category != 'CLASSIC'">Advance configuration</p>

            <ng-container>
              <p class="text-dark font-weight-bold">Conditions:</p>
              <div *ngFor="let item of couponDetails?.advancedConfiguration?.constraints; let j=index;">
                <p class="text-center" *ngIf="j != 0">{{couponDetails?.advancedConfiguration?.operand}}</p>
                <p>
                    Source: <strong> {{item.source}}</strong>
                </p>
                <p>
                  Units: <strong>{{item.minimumUnit}} - {{item.maximumUnit}} {{item.unitOfMeasure}}</strong>
                </p>
                <p>Interval:
                  <strong *ngIf="item?.timeConstraint?.constraintType == 'INTERVAL'">{{item?.timeConstraint?.intervalMinValue}}  - {{item?.timeConstraint?.intervalMaxValue}} {{item?.timeConstraint?.intervalUnit}} </strong>
                  <strong *ngIf="item?.timeConstraint?.constraintType != 'INTERVAL'">{{utils.getDisplayTime(item?.timeConstraint?.startDate)}}  - {{utils.getDisplayTime(item?.timeConstraint?.endDate)}} </strong>
                </p>
                <ng-container *ngIf="item.constraintOutputType != 'NONE'">
                  <p>Factor: <strong>{{item.constraintOutputValue}} per {{item.unitOfMeasure}}</strong></p>
                </ng-container> 

              </div>
            </ng-container>

      </div>
    </div>
  </div>

  <div class="col-lg-8 mt-4">
    <div class="card card-custom" *ngIf="filteredCentersList?.length">
      <div class="card-body pt-4">
        <div class="d-flex justify-content-between align-items-baseline">
          <div class="font-size-h5 mb-3 font-weight-bold text-success">Coupon Usage</div>

        </div>
        <div class="form form-label-right">
          <div class="form-group row">
            <div class="col-lg-12">
              <input type="text" class="form-control" (keyup.enter)="onSearch()" [(ngModel)]="searchText" placeholder="Search"
                value="" />
              <small class="form-text text-muted"><b>Search</b>by customer name and phone</small>
            </div>
          </div>
        </div>
        <div class="table-responsive angular-bootstrap-table">
          <table class="table table-head-custom table-vertical-center overflow-hidden">
            <thead>

              <th name="customerName" ngDefaultControl [(ngModel)]="tableHeader.customerName"
                (click)="onSort('customerName')">
                <i *ngIf="tableHeader.customerName === 1 && activeSort === 'customerName'"
                  class="fas fa-long-arrow-alt-up"></i>
                <i *ngIf="tableHeader.customerName === 0 && activeSort === 'customerName'"
                  class="fas fa-long-arrow-alt-down"></i>
                Name
              </th>

              <th name="customerPhone" ngDefaultControl [(ngModel)]="tableHeader.customerPhone"
                (click)="onSort('customerPhone')">
                <i *ngIf="tableHeader.customerPhone === 1 && activeSort === 'customerPhone'"
                  class="fas fa-long-arrow-alt-up"></i>
                <i *ngIf="tableHeader.customerPhone === 0 && activeSort === 'customerPhone'"
                  class="fas fa-long-arrow-alt-down"></i>
                Phone
              </th>

              <th>Customer</th>

              <th name="couponAmount" ngDefaultControl [(ngModel)]="tableHeader.couponAmount"
                (click)="onSort('couponAmount')">
                <i *ngIf="tableHeader.couponAmount === 1 && activeSort === 'couponAmount'"
                  class="fas fa-long-arrow-alt-up"></i>
                <i *ngIf="tableHeader.couponAmount === 0 && activeSort === 'couponAmount'"
                  class="fas fa-long-arrow-alt-down"></i>
                  Amount
              </th>

              <th name="createdDate" ngDefaultControl [(ngModel)]="tableHeader.createdDate"
                (click)="onSort('createdDate')">
                <i *ngIf="tableHeader.createdDate === 1 && activeSort === 'createdDate'"
                  class="fas fa-long-arrow-alt-up"></i>
                <i *ngIf="tableHeader.createdDate === 0 && activeSort === 'createdDate'"
                  class="fas fa-long-arrow-alt-down"></i>
                Date
              </th>
            </thead>
            <tbody>
              <tr *ngFor="let item of filteredCentersList">

                <td>{{ item.customerName | titlecase}}</td>
                <td>
                  <a matTooltip="Customer Details" class="btn btn-link-success font-weight-bold"
                    (click)="customerDetails(item)">
                    {{ item.customerPhone }}</a>
                </td>
                <td>{{ item.customerType | titlecase}}</td>
                <td>{{item.couponAmount}}</td>
                <td>{{ item.createdDate }}</td>

              </tr>
            </tbody>
          </table>
        </div>
        <div class="row">
          <div class="mr-2">
            <nav aria-label="Page navigation example">
              <ul class="pagination">
                <li class="page-item">
                  <a class="page-link" [ngClass]="{'disabled': paginationData?.currentPage === 0}" (click)="onPageChange(0)" href="javascript:void(0);">
                    <span aria-hidden="true">&laquo;&laquo;</span>
                    <span class="sr-only">First</span>
                  </a>
                </li>
                <li class="page-item">
                  <a class="page-link" [ngClass]="{'disabled': paginationData?.currentPage === 0}" (click)="onPageChange(paginationData.currentPage - 1)" href="javascript:void(0);">
                    <span aria-hidden="true">&laquo;</span>
                    <span class="sr-only">Previous</span>
                  </a>
                </li>
                <li class="page-item">
                  <a class="page-link" *ngIf="paginationData?.currentPage !== 0 && paginationData?.currentPage !== 1" (click)="onPageChange(paginationData?.currentPage - 2)" href="javascript:void(0);">{{ paginationData?.currentPage -1 }}</a>
                </li>
                <li class="page-item">
                  <a class="page-link" *ngIf="paginationData?.currentPage !== 0" (click)="onPageChange(paginationData?.currentPage - 1)" href="javascript:void(0);">{{ paginationData?.currentPage}}</a>
                </li>
                <li class="page-item">
                  <a class="page-link active" href="javascript:void(0);">{{ paginationData?.currentPage + 1 }}</a>
                </li>
                <li class="page-item">
                  <a class="page-link" *ngIf="paginationData?.pages.length !== 0 && paginationData?.currentPage !== paginationData.pages.length - 1" (click)="onPageChange(paginationData?.currentPage + 1)" href="javascript:void(0);">{{ paginationData?.currentPage + 2 }}</a>
                </li>
                <li class="page-item">
                  <a class="page-link" *ngIf="paginationData?.pages.length !== 0 && paginationData?.currentPage !== paginationData.pages.length - 1 && paginationData?.currentPage !== paginationData.pages.length - 2" (click)="onPageChange(paginationData?.currentPage + 2)" href="javascript:void(0);">{{ paginationData?.currentPage + 3 }}</a>
                </li>
                <li class="page-item">
                  <a class="page-link" [ngClass]="{'disabled': paginationData?.currentPage === paginationData.pages.length - 1 || paginationData?.pages.length === 0}" (click)="onPageChange(paginationData.currentPage + 1)" href="javascript:void(0);">
                    <span aria-hidden="true">&raquo;</span>
                    <span class="sr-only">Next</span>
                  </a>
                </li>
                <li class="page-item">
                  <a class="page-link" [ngClass]="{'disabled': paginationData?.currentPage === paginationData.pages.length - 1 || paginationData?.pages.length === 0}" (click)="onPageChange(paginationData.pages.length - 1)" href="javascript:void(0);">
                    <span aria-hidden="true">&raquo;&raquo;</span>
                    <span class="sr-only">Last</span>
                  </a>
                </li>
              </ul>
            </nav>
          </div>
          <div class="mr-2">
            <select class="custom-select" style="height: calc(1.2em + 1rem + 2px); padding: 0.35rem 2rem 0.35rem 1rem;"
              [(ngModel)]="paginationData.pageSize" (change)="onPageSizeChange()">
              <option [ngValue]="10">10 per page</option>
              <option [ngValue]="50">50 per page</option>
              <option [ngValue]="100">100 per page</option>
            </select>
          </div>
          <div class="pt-2">
            <small class="text-muted">(Total: {{paginationData.total}})</small>
          </div> 
        </div>
      </div>
    </div>
  </div>


</div>