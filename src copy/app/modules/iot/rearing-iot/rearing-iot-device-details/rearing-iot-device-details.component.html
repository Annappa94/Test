<div class="bg-white rounded mb-4 d-flex align-items-center py-2 sticky-header justify-content-between">
    <ul id="breadcrumbs">
        <li><span style="cursor: pointer;" class="hover-item" (click)="gobackToDeviceList()">All Devices</span></li>
        <li><span>{{deviceId}}</span></li>
    </ul>
    <div>
        <app-back-button></app-back-button>
    </div>
</div>
<div class="row">
    <div class="col-lg-4 col-md-4 col-sm-4">
        <div class="card card-custom gutter-b">
            <div class="card-body pt-4">
                <div class="d-flex justify-content-between align-items-baseline mt-5">
                    <div class="text-dark-75 font-weight-bolder pr-1">
                        Device Details
                    </div>
                </div>
                <div class="mb-7">
                    <div class="d-flex justify-content-between align-items-center my-2">
                        <span class="text-muted font-weight-bolder mr-2">Created By:</span>
                        <span
                            class="text-dark-75 font-weight-bold">{{rearingIotDeviceData?.createdBy}}</span>
                    </div>
                  
                    <div class="d-flex justify-content-between align-items-center my-2">
                        <span class="text-muted font-weight-bolder mr-2">Created Date:</span>
                        <span
                            class="text-dark-75 font-weight-bold">{{rearingIotDeviceData?.createdDate | date:'dd-MM-yyyy h:mm a'}}</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center my-2">
                        <span class="text-muted font-weight-bolder mr-2">Last Modified By:</span>
                        <span
                            class="text-dark-75 font-weight-bold">{{rearingIotDeviceData?.lastModifiedBy}}</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center my-2">
                        <span class="text-muted font-weight-bolder mr-2">Last Mofied Date</span>
                        <span
                            class="text-dark-75 font-weight-bold">{{rearingIotDeviceData?.lastModifiedDate|date:'dd-MM-yyyy h:mm a'}}</span>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center my-2">
                        <span class="text-muted font-weight-bolder mr-2">Device Status:</span>
                        <span
                            class="text-dark-75 font-weight-bold">{{rearingIotDeviceData?.status}}</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center my-2">
                        <span class="text-muted font-weight-bolder mr-2">Device Serial ID:</span>
                        <span
                            class="text-dark-75 font-weight-bold">{{rearingIotDeviceData?.deviceSerialId}}</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center my-2">
                        <span class="text-muted font-weight-bolder mr-2">Authenticated:</span>
                        <span
                            class="text-dark-75 font-weight-bold">{{rearingIotDeviceData?.authenticated}}</span>
                    </div>
                </div>
                <div class="d-flex justify-content-between align-items-baseline mt-5">
                    <div class="text-dark-75 font-weight-bolder pr-1">
                        Life Cycle Details 
                    </div>
                </div>
                <div class="text-right" *ngIf="deviceInformation?.lifecycleTracker?.status !== 'ACTIVE' ">
                    <button type="button" class="btn btn-primary btn-sm mt-3 mb-3" (click)="Lifecycletracker()">Activate Life Cycle Tracker</button>
                </div>
                <div class="d-flex justify-content-between align-items-center my-2" *ngIf="deviceInformation?.lifecycleTracker?.startDate">
                    <span class="text-muted font-weight-bolder mr-2">Start Date:</span>
                    <span
                        class="text-dark-75 font-weight-bold">{{deviceInformation?.lifecycleTracker?.startDate|date:'dd-MM-yyyy h:mm a'}}</span>
                </div>
                <div class="d-flex justify-content-between align-items-center my-2">
                    <span class="text-muted font-weight-bolder mr-2">Life Cycle Status:</span>
                    <span
                        class="text-dark-75 font-weight-bold">{{deviceInformation?.lifecycleTracker?.status || 'INACTIVE'}}</span>
                </div>
                <div class="d-flex justify-content-between align-items-center my-2"  *ngIf="deviceInformation?.lifecycleTracker?.dayOfChawki">
                    <span class="text-muted font-weight-bolder mr-2">Day of Chawki:</span>
                    <span
                        class="text-dark-75 font-weight-bold">{{deviceInformation?.lifecycleTracker?.dayOfChawki}}</span>
                </div>
                <div class="d-flex justify-content-between align-items-center my-2"  *ngIf="deviceInformation?.lifecycleTracker?.currentStage">
                    <span class="text-muted font-weight-bolder mr-2">Current Stage:</span>
                    <span
                        class="text-dark-75 font-weight-bold">{{deviceInformation?.lifecycleTracker?.currentStage}}</span>
                </div>
                <div class="d-flex justify-content-between align-items-baseline mt-5">
                    <div class="text-dark-75 font-weight-bolder pr-1">
                        Farmer Details
                    </div>
                </div>
                <div class="d-flex justify-content-between align-items-center my-2">
                    <span class="text-muted font-weight-bolder mr-2">Farmer Id:</span>
                    <span class="text-dark-75 font-weight-bold">{{deviceInformation?.deviceAllocationDetails?.farmerId}}</span>
                </div>
                <div class="d-flex justify-content-between align-items-center my-2">
                    <span class="text-muted font-weight-bolder mr-2">Farmer Name:</span>
                    <span
                        class="text-dark-75 font-weight-bold">{{deviceInformation?.deviceAllocationDetails?.farmerName}}</span>
                </div>
                <div class="d-flex justify-content-between align-items-center my-2">
                    <span class="text-muted font-weight-bolder mr-2">Farmer Phone:</span>
                    <span
                        class="text-dark-75 font-weight-bold">{{deviceInformation?.deviceAllocationDetails?.farmerPhone}}</span>
                </div>

                <div class="d-flex justify-content-between align-items-center my-2">
                    <span class="text-muted font-weight-bolder mr-2">Chawki Date:</span>
                    <span class="text-dark-75 font-weight-bold">{{deviceInformation?.chawkiDate | date: 'M/d/yy, h:mm a'}}<i class="ml-2 flaticon2-pen text-muted cursor-pointer" (click)="openchakidatepopup(content)"></i></span>
                </div>
                

                <div class="d-flex justify-content-between align-items-baseline mt-5">
                    <div class="text-dark-75 font-weight-bolder pr-1">
                        Agronomist Details
                    </div>
                </div>
                <div class="d-flex justify-content-between align-items-center my-2">
                    <span class="text-muted font-weight-bolder mr-2">Agronomist Id:</span>
                    <span
                        class="text-dark-75 font-weight-bold">{{deviceInformation?.deviceAllocationDetails?.agronomistId}}</span>
                </div>
                <div class="d-flex justify-content-between align-items-center my-2">
                    <span class="text-muted font-weight-bolder mr-2">Agronomist Name:</span>
                    <span
                        class="text-dark-75 font-weight-bold">{{deviceInformation?.deviceAllocationDetails?.agronomistName}}</span>
                </div>
                <div class="d-flex justify-content-between align-items-center my-2">
                    <span class="text-muted font-weight-bolder mr-2">Agronomist Phone:</span>
                    <span
                        class="text-dark-75 font-weight-bold">{{deviceInformation?.deviceAllocationDetails?.agronomistPhone}}</span>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-8">
        <div class="col-lg-12">
            <div class="card card-custom gutter-b" *ngIf="deviceInformation">
                <div class="card-header">
                    <div class="card-title">
                      <h3 class="card-label">Latest Sensor Readings <br><br> Last Synced at {{deviceInformation?.readingData?.time |  date: 'medium':'+0530' }} </h3>
                      
                    </div>
                    <div class="card-toolbar">
                        <div>
                          <span
                              [ngClass]="deviceInformation?.readingData?.signalPercentage =='Excellent'?'battery-green':'battery-red'">Signal
                              strength: <b>{{ deviceInformation?.readingData?.signalPercentage !== null ?
                                  deviceInformation?.readingData?.signalPercentage + '%' : 'No Data'}}</b></span>
                          <br>
                          <span
                              [ngClass]="deviceInformation?.readingData?.batteryPercentage >=10?'battery-green':'battery-red'">Battery:
                              <b>{{ deviceInformation?.readingData?.batteryPercentage !== null ?
                                  deviceInformation?.readingData?.batteryPercentage + '%' : 'No Data'}}</b></span><br>
                          <span>Power source: <b>{{deviceInformation?.readingData?.powerSource}}</b></span><br>
                          <span>Stage Information: <b>{{deviceInformation?.threshold?.dayOfChawki}}</b> Day</span>
                          <br>
                          <span>Current Stage:<b>{{deviceInformation?.lifecycleTracker?.currentStage.replace('_', ' ')}}</b></span>
                        </div>
                      </div>
                  </div>
                  <div class="card-body">
                      <div class="row mt-3 mb-3">
                        <div class="col-lg-5 p-3 mr-3 border border-darken-1 rounded" [ngClass]="(deviceInformation?.readingData?.temperature < deviceInformation?.threshold?.temperature?.min || deviceInformation?.readingData?.temperature > deviceInformation?.threshold?.temperature?.max)?'border-color-red':'border-color-green'">
                          <label class="form-text text-success" [ngClass]="{'danger':(deviceInformation?.readingData?.temperature < deviceInformation?.threshold?.temperature?.min || deviceInformation?.readingData?.temperature > deviceInformation?.threshold?.temperature?.max)}" >
                              Temperature: <span class="ml-3 font-size-h3">{{deviceInformation?.readingData?.temperature}} &deg;C</span>
                          </label>
                          <div class="text-muted">Ideal: {{deviceInformation?.threshold?.temperature?.min}} &deg; - {{deviceInformation?.threshold?.temperature?.max}} &deg;C</div>
                      </div>
                      <div class="col-lg-5 p-3 mr-3 border border-darken-1 rounded" [ngClass]="(deviceInformation?.readingData?.humidity < deviceInformation?.threshold?.humidity?.min || deviceInformation?.readingData?.humidity > deviceInformation?.threshold?.humidity?.max)?'border-color-red':'border-color-green'">
                          <label class="form-text text-success" [ngClass]="{'danger':(deviceInformation?.readingData?.humidity < deviceInformation?.threshold?.humidity?.min || deviceInformation?.readingData?.humidity > deviceInformation?.threshold?.humidity?.max)}" >
                              Humidity: <span class="ml-3 font-size-h3">{{deviceInformation?.readingData?.humidity}} %</span>
                          </label>
                          <div class="text-muted">Ideal: {{deviceInformation?.threshold?.humidity?.min}} % - {{deviceInformation?.threshold?.humidity?.max}}%</div>
                      </div>
                      </div>
                  </div>
            </div>
        </div>
         <div class="col-lg-12">
            <app-paginated-table [rowDataList]="rowList" [tableHeaders]="Headers" [totalRecords]="totalRecords" (onPageChange)="onPageChange($event)"  [searchClass]="'col-lg-4'" 
            [titleOfTable]="'Alerts'" [searchHint]="'By Day'"
            [defaultImage]="'./assets/media/svg/files/jpg.svg'"></app-paginated-table>
         </div>  
    </div>
</div>

<ng-container>
    <app-paginated-table [rowDataList]="rowDataList" [tableHeaders]="tableHeaders" [totalRecords]="totalRecords" (onPageChange)="onPageChange($event)"  [searchClass]="'col-lg-5'" 
    [titleOfTable]="'Followup Notes'" [searchHint]="'By Day'"
    [defaultImage]="'./assets/media/svg/files/jpg.svg'"
    >
    <div class="card-toolbar New">
      <div>
      <button  type="button" class="btn btn-sm btn-success mr-2" (click)="recordAdvisory(advisory,deviceInformation)">+ New Followup </button>
      </div>
    </div> 
    <div class="row col-12 mt-3">
        <!-- <div class="col-lg-8">
          <app-custom-date-picker [startTitle]="'Created start date'" [endTitle]="'Created end date'"
          (listenForDate)="listenForDate($event)"></app-custom-date-picker>
        </div> -->
        <!-- <div class="col-lg-3">
            <select class="form-control form-control-lg" name="instartStage"
              placeholder="Instart Stage" (change)="onInstartStage($event.target.value)">
              <option value="" selected>All</option>
              <option value="" selected>New</option>
              <option *ngFor="let instar of instartStageList" [value]="instar">{{instar}}</option>
            </select>
        </div> -->
        <!-- <div class="col-lg-1">
            <a (click)="downLoadXLFile();">
                <span matTooltip="Download Report" class="btn btn-icon btn-outline-success btn-sm mr-2">
                  <i class="flaticon-download"></i>
                </span>
              </a>
        </div> -->
    <!-- </div>
  </app-paginated-table>
</ng-container> -->


<div class="example-preview" [formGroup]="chakidateForm">
    <div>
        <ng-template #content let-c="close" let-d="dismiss">
            <div class="modal-header text-center">
                <h4 class="modal-title w-100">Change Chawki Date</h4>  
            </div>
            <div class="modal-body">

                <div class="col-lg-6 mt-2" style="top:0;left: 0;right: 0;margin: auto;">
                    <mat-form-field class="w-100 cursor-pointer" appearance="fill" (click)="dp3.open()">
                      <input matInput [matDatepicker]="dp3" formControlName="chawkiDate">
                      <mat-datepicker-toggle matSuffix [for]="dp3"></mat-datepicker-toggle>
                      <mat-datepicker #dp3></mat-datepicker>
                    </mat-form-field>
                  </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-sm" (click)="cancelDateChange()">Cancel</button>
                <button type="button" class="btn btn-primary btn-sm" (click)="updateChawkidate()">Save</button> 
            </div>
        </ng-template>
    </div>
</div>

<div class="example-preview">
    <div>
        <ng-template #advisory let-c="close" let-d="dismiss" [formGroup]="recordAdvisoryForm">
            <div class="modal-header text-center"> 
                <h4>Record Advisory</h4>  
            </div>
            <div class="modal-body">
                <div class="container">
                <div class="row" >
                    <div class="col-lg-4" style="top:0;left: 0;right: 0;margin: auto;" >
                        <label>Chawki startDate</label>
                        <mat-form-field class="w-100 cursor-pointer" appearance="fill" (click)="dp3.open()">
                          <input matInput [matDatepicker]="dp3" formControlName="chawkiStartDate"  disabled>
                          <mat-datepicker-toggle matSuffix [for]="dp3"></mat-datepicker-toggle>
                          <mat-datepicker #dp3></mat-datepicker>
                        </mat-form-field>
                      </div>
                    <div class="col-lg-4">
                        <label>Instar Stage <span class="text-danger"></span></label>
                        <input type="text" class="form-control form-control-lg" name="payTerms" placeholder=""
                            autocomplete="off" formControlName="instarStage" disabled/>
                            <p class="text-danger"></p>
                    </div>
                    <div class="col-lg-4">
                        <label>Instar Day <span class="text-danger"></span></label>
                        <input type="text" class="form-control form-control-lg" name="payTerms" placeholder=""
                            autocomplete="off" formControlName="instarDay" disabled/>
                            <p class="text-danger" >
                    </div>
                    <div class="col-lg-4">
                        <label>CurrentTemperature <span><br><b>Ideal: {{deviceInformation?.threshold?.temperature?.min}} &deg; - {{deviceInformation?.threshold?.temperature?.max}} &deg;C</b></span></label>
                        <input type="text" class="form-control form-control-lg" name="payTerms" placeholder=""
                            autocomplete="off" formControlName="currentTemperature" disabled/>
                            <p class="text-danger" >
                    </div>
                    <div class="col-lg-4">
                        <label>Current Humidity    <span><br><b>Ideal: {{deviceInformation?.threshold?.humidity?.min}} % - {{deviceInformation?.threshold?.humidity?.max}}%</b></span></label>
                        <input type="text" class="form-control form-control-lg" name="payTerms" placeholder=""
                            autocomplete="off" formControlName="currentHumidity" disabled/>
                            <p class="text-danger" >
                    </div>
                    <div class="col-lg-4 mt-5">
                        <label>Bed Disinfectant used<span class="text-danger"></span></label>
                        <select class="form-control form-control-lg" formControlName="disinfectantUsed" name="isActive"
                          placeholder="Display" >
                          <option>Vijetha Forte</option>
                          <option>Vijetha Green</option>
                          <option>Ankush Green</option>
                          <option>Lime Powder</option>
                          <option>A Powder</option>
                          <option>B Powder</option>
                        </select>
                    </div>
                    <div class="col-lg-4" style="top:0;left: 0;right: 0;margin: auto;" >
                        <label>Feeding Time</label>
                        <mat-form-field  class="form-control-file ">
                            <!-- <mat-placeholder>Start DateTime</mat-placeholder> -->
                            <input
                              matInput
                              [matDatetimepicker]="dts1"
                              required
                              autocomplete="false"
                              formControlName="feedingTime"
                              timeInterval="5"
                              />
                            <mat-datetimepicker-toggle
                              [for]="dts1"
                              matSuffix
                            ></mat-datetimepicker-toggle>
                            <mat-datetimepicker
                              #dts1
                              type="datetime"
                              openOnFocus="true"
                              timeInterval="5"
                              twelvehour="true"
                            ></mat-datetimepicker>
                           </mat-form-field>
                           <!-- </div> -->
                      </div>
                    <div class="col-lg-4">
                        <label>Mulberry Quantity<span class="text-danger"></span></label>
                        <input type="text" class="form-control form-control-lg" name="payTerms" placeholder=""
                            autocomplete="off" />
                            <p class="text-danger" >
                    </div>
                    <div class="col-lg-4">
                        <label>Visited Farmer<span class="text-danger"></span></label>
                        <select class="form-control form-control-lg" formControlName="visitedFarmer" name="isActive"
                          placeholder="Display">
                          <option value="true">Yes</option>
                          <option value="false">No</option>
                        </select>
                    </div>

                    <div class="form-outline w-50 mr-4">
                        <label> Auto Advisory <span class="text-danger"></span></label>
                        <textarea class="form-control" id="textAreaExample6" rows="3"  formControlName="autoAdvisory"  disabled></textarea>
                        <label class="form-label" for="textAreaExample6"></label>
                      </div>
                      <div class="form-group  mr-6">
                        <label> Advisory Provided To Farmer <span class="text-danger"></span></label>
                        <textarea class="form-control" style="width: 190%;" id="exampleFormControlTextarea1" rows="3" formControlName="advisoryProvidedToFarmer"></textarea>
                      </div>
                      <div class="form-group mr-4">
                        <label>Remarks <span class="text-danger"></span></label>
                        <textarea class="form-control"  id="exampleFormControlTextarea1" rows="3" formControlName="remarks"></textarea>
                      </div>
                      <div class="col-lg-4 mr-4">  <span>Upload Image</span>
                        <div class="image-input image-input-outline m-2 mt-2" id="kt_profile_avatar">
                          <!-- <img class="image-input-wrapper cursor-pointer" /> -->
                          <img class="image-input-wrapper"
                          [src]="recordAdvisoryForm.get('uploadedImage').value? recordAdvisoryForm.get('uploadedImage')?.value?.includes('.pdf')?'./assets/media/svg/files/pdf.svg': './assets/media/svg/files/jpg.svg' : './assets/media/users/blank.png'"
                          (click)="showImage(recordAdvisoryForm.get('uploadedImage').value)"/>
                          <label class="btn btn-xs btn-icon btn-circle btn-white btn-hover-text-primary btn-shadow"
                            data-action="change" data-toggle="tooltip" title="" data-original-title="Change avatar">
                            <i class="fa fa-pen icon-sm text-muted"></i>
                            <input type="file" name="profile_avatar"
                            accept=".png, .jpg, .jpeg, .pdf"
                            (change)="onImageUpload($event);" />
                        <input type="hidden" name="profile_avatar_remove" />
                          </label>
                        </div>
                      </div>
                     
                </div>
                </div>
                </div>       
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-sm" (click)="c('Close click')">Cancel</button>
                <button type="button" class="btn btn-primary btn-sm" (click)="createRecordAdvisory()" >Save</button> 
            </div>
        </ng-template>
    </div>
</div>