<div class="card card-custom gutter-b">
  <div class="card-header">
    <div class="card-title">
      <h3 class="card-label">{{id ? "Update Ginner Details" : "New Ginner Details" }}</h3>
    </div>
    <div class="card-toolbar">
      <!-- Nothing right now-->
    </div>
  </div>
  <div class="card-body pt-0">

    <!-- Farmer FORM -->
    <div class="form form-label-right">
      <div class="form-group row" style="padding-top: 0px;">
        <div class="col-lg-12">
          <div class="row" [formGroup]="formGroup">
            <div class="col-lg-3 mt-2" *ngIf="!id">
                <label class="form-label">Name<span class="text-danger">*</span></label>
                <input type="text" class="form-control form-control-lg" name="name" placeholder="Name"
                  autocomplete="off" [class.is-invalid]="isControlInvalid('name')"
                  [class.is-valid]="isControlValid('name')" formControlName="name" />
                <div class="valid-feedback" *ngIf="isControlValid('name')">Name was entered correct</div>
                <div class="invalid-feedback" *ngIf="controlHasError('required', 'name')">Name is required</div>
                <div class="invalid-feedback" *ngIf="controlHasError('pattern', 'name')">Name should have letters only</div>
              </div>
              <div class="col-lg-3 mt-2" *ngIf="id">
                <label class="form-label">Name<span class="text-danger">*</span></label>
                <input type="text" class="form-control form-control-lg" name="name" placeholder="Name"
                  autocomplete="off" [class.is-invalid]="isControlInvalid('name')"
                  [class.is-valid]="isControlValid('name')" formControlName="name" disabled />
                <div class="valid-feedback" *ngIf="isControlValid('name')">Name was entered correct</div>
                <div class="invalid-feedback" *ngIf="controlHasError('required', 'name')">Name is required</div>
                <div class="invalid-feedback" *ngIf="controlHasError('pattern', 'name')">Name should have letters only</div>
              </div>
            <div class="col-lg-3 mt-2" *ngIf="!id">
              <label class="form-label">Mobile Number<span class="text-danger">*</span></label>
              <input type="text" class="form-control form-control-lg" name="phone" placeholder="Mobile Number"
                autocomplete="off" [class.is-invalid]="isControlInvalid('phone')"
                [class.is-valid]="isControlValid('phone')" formControlName="phone"  />
              <div class="valid-feedback" *ngIf="isControlValid('phone')">Mobile number was entered correct
              </div>
              <div class="invalid-feedback" *ngIf="controlHasError('required', 'phone')">Mobile number is
                required</div>
            </div>
            <div class="col-lg-3 mt-2" *ngIf="id">
              <label class="form-label">Mobile Number<span class="text-danger">*</span></label>
              <input type="text" class="form-control form-control-lg" name="phone" placeholder="Mobile Number"
                autocomplete="off" [class.is-invalid]="isControlInvalid('phone')"
                [class.is-valid]="isControlValid('phone')" formControlName="phone" disabled />
              <div class="valid-feedback" *ngIf="isControlValid('phone')">Mobile number was entered correct
              </div>
              <div class="invalid-feedback" *ngIf="controlHasError('required', 'phone')">Mobile number is
                required</div>
            </div>
<!-- 
            <div class="col-lg-3 mt-2">
              <label>Select Center<span class="text-danger">*</span></label>
              <select class="form-control form-control-lg" formControlName="center" name="Center"
                placeholder="Select Center">
                <option *ngFor="let item of centerList" [value]="item.id">{{item.centerName}}</option>
              </select>
            </div> -->

            <!--               
              <div class="col-lg-3 mt-2">
                <label class="form-label">Referred by</label>
                <input type="text" class="form-control form-control-lg"
                  placeholder="Referred by" autocomplete="off" formControlName="refferedBy" />
              </div> -->
            <div class="col-lg-3 mt-2" *ngIf="!id">
              <label>Select Customer Type<span class="text-danger">*</span></label>
              <select class="form-control form-control-lg" formControlName="customerType" name="customerType"
                placeholder="Select Customer Type">
                <option *ngFor="let item of kycCustomerTypes" [value]="item.id">{{item.name}}</option>
              </select>
            </div>

            <div class="col-lg-3 mt-2" *ngIf="id">
              <label>Select Customer Type<span class="text-danger">*</span></label>
              <select class="form-control form-control-lg" formControlName="customerType" name="customerType"
                placeholder="Select Customer Type" disabled>
                <option *ngFor="let item of kycCustomerTypes" [value]="item.id">{{item.name}}</option>
              </select>
            </div>

            <!-- <div class="col-lg-3 mt-2" *ngIf="!id">
              <label class="form-label">GST Number</label><span class="text-danger">*</span>
              <input type="text" class="form-control form-control-lg" placeholder="GST Number" autocomplete="off"
                formControlName="gstNumber" />
            </div>  -->
            <div class="col-lg-3 mt-2" *ngIf="!id">
              <label class="form-label">GST Number<span class="text-danger">*</span></label>
              <input type="text" class="form-control form-control-lg" name="gstNumber" placeholder="GST Number"
                autocomplete="off" [class.is-invalid]="isControlInvalidForSpinning('gstNumber')"
                [class.is-valid]="isControlValidForSpinning('gstNumber')" formControlName="gstNumber"
                style="text-transform:uppercase" />
              <div class="invalid-feedback" *ngIf="controlHasErrorForSpinning('required', 'gstNumber')">Gst is required
              </div>
               <div class="invalid-feedback" *ngIf="controlHasErrorForSpinning('pattern', 'gstNumber')">Gst is Invalid
              </div>
              <div class="valid-feedback" *ngIf="isControlValidForSpinning('gstNumber')">Gst is Valid</div> 
            </div>

            <div class="col-lg-3 mt-2" *ngIf="id">
              <label class="form-label">GST Number</label><span class="text-danger">*</span>
              <input type="text" class="form-control form-control-lg" placeholder="GST Number" autocomplete="off"
                formControlName="gstNumber" disabled/>
            </div>
            <div class="col-lg-2 mt-10" *ngIf="!id">
              <button type="button" class="btn btn-success btn-md"
                [disabled]="formGroup.invalid"
                (click)="gstVerified(formGroup.value)">Verify Gst</button>
            </div>

            <!--ginning mill detailes-->
            <div [formGroup]="formGroup" *ngIf="id">
              <div class="col-lg-12 mt-6">
                <ngb-accordion #acc11="ngbAccordion" activeIds="toggle-spinning-mill-derails">
                  <ngb-panel id="toggle-spinning-mill-derails">
                    <ng-template ngbPanelTitle>
                      <span class="ard-header--title text-success">Ginning Mill Details</span>
                    </ng-template>
                    <ng-template ngbPanelContent>
                      <div class="row">
                        <div class="col-lg-3 mt-4">
                          <label class="form-label">Name</label>
                          <!-- <input type="text" class="form-control form-control-lg form-control-solid" name="name"
                              placeholder="Name" formControlName="name" readonly /> -->
                          <textarea class="form-control form-control-lg form-control-solid" name="name" id="" cols="10"
                            rows="3" placeholder="Name" formControlName="gstnLegalName" readonly></textarea>
                        </div>
                        <div class="col-lg-3 mt-4">
                          <label class="form-label">Principal place of business</label>
                          <!-- <input type="text" class="form-control form-control-lg form-control-solid"
                              name="principalPlaceBusiness" placeholder="Principal place"
                              formControlName="principalPlaceBusiness" readonly /> -->
                          <textarea class="form-control form-control-lg form-control-solid"
                            name="principalPlaceBusiness" id="" cols="10" rows="3" placeholder="Principal place"
                            formControlName="principalPlaceBusiness" readonly></textarea>

                        </div>
                        <div class="col-lg-3 mt-4">
                          <label class="form-label">Additional place of business</label>
                          <!-- <input type="text" class="form-control form-control-lg form-control-solid"
                              name="additionalPlaceBusiness" placeholder="Additional place"
                              formControlName="additionalPlaceBusiness" readonly /> -->
                          <textarea class="form-control form-control-lg form-control-solid"
                            name="additionalPlaceBusiness" id="" cols="10" rows="3" placeholder="Additional place"
                            formControlName="additionalPlaceBusiness" readonly></textarea>

                        </div>
                        <div class="col-lg-3 mt-4">
                          <label class="form-label">Jurisdiction state</label>
                          <input type="text" class="form-control form-control-lg form-control-solid"
                            name="jurisdictionState" placeholder="Juridiction state" formControlName="jurisdictionState"
                            readonly />
                        </div>
                        <div class="col-lg-3 mt-4">
                          <label class="form-label">Business constitution</label>
                          <input type="text" class="form-control form-control-lg form-control-solid"
                            name="businessConstitution" placeholder="Business constitution"
                            formControlName="businessConstitution" readonly />
                        </div>
                        <div class="col-lg-3 mt-4">
                          <label class="form-label">Date of Registration</label>
                          <input type="text" class="form-control form-control-lg form-control-solid"
                            name="dateRegisterd" placeholder="Registerd date" formControlName="dateRegisterd"
                            readonly />
                        </div>
                        <div class="col-lg-3 mt-4">
                          <label class="form-label">Taxpayer Type</label>
                          <input type="text" class="form-control form-control-lg form-control-solid" name="taxpayerType"
                            placeholder="Taxpayer type" formControlName="taxpayerType" readonly />
                        </div>
                        <div class="col-lg-3 mt-4">
                          <label class="form-label">GSTIN status </label>
                          <input type="text" class="form-control form-control-lg form-control-solid" name="gstinstatus"
                            placeholder="Gstin status " formControlName="gstinstatus" readonly />
                        </div>
                        <div class="col-lg-3 mt-4">
                          <label class="form-label">Cancellation date </label>
                          <input type="text" class="form-control form-control-lg form-control-solid"
                            name="cancelationDate" placeholder="Canceled date " formControlName="cancelationDate"
                            readonly />
                        </div>
                        <div class="col-lg-3 mt-4">
                          <label class="form-label">Last Verified Date & Time</label>
                          <input class="form-control form-control-lg form-control-solid" name="lastVerified"
                            placeholder="Last verified at" formControlName="lastVerified" readonly />
                        </div>
                        <div class="col-lg-3 mt-4" *ngIf="id">
                          <label class="form-label">Email address</label>
                          <input type="email" class="form-control form-control-lg " name="email" placeholder="Email"
                            formControlName="email"  disabled/>
                        </div>
                      </div>
                    </ng-template>
                  </ngb-panel>
                </ngb-accordion>
              </div>


              <div class="col-lg-12 mt-6">
                <ngb-accordion #acc11="ngbAccordion">
                  <ngb-panel id="toggle-address">
                    <ng-template ngbPanelTitle>
                      <span class="ard-header--title text-success">Cotton Details</span>
                    </ng-template>
                    <ng-template ngbPanelContent>
                      <div class="row">
                        <div class="col-lg-3 mt-2">
                          <label class="form-label">Land Size ( Acres )</label>
                          <input type="number" class="form-control form-control-lg" name="Land Size"
                            placeholder="Land Size in Acres" autocomplete="off" formControlName="landSize" />
                        </div>

                        <div class="col-lg-3 mt-2">
                          <label class="form-label">Cotton Types</label>
                          <mat-form-field appearance="legacy" class="w-100">
                            <mat-select multiple formControlName="cottonTypes">
                              <mat-option *ngFor="let item of cottonTypes" [value]="item">
                                {{item}}
                              </mat-option>
                            </mat-select>
                          </mat-form-field>
                        </div>

                        <div class="col-lg-3 mt-2">
                          <label class="form-label">Production Capacity (Bales/Day)</label>
                          <input type="number" class="form-control form-control-lg" name="city" placeholder="Bales/day"
                            autocomplete="off" formControlName="productionCapacityBalesPerDay" />
                        </div>

                        <div class="col-lg-3 mt-2">
                          <label class="form-label">Ginning License Number</label>
                          <input type="number" class="form-control form-control-lg" name="city"
                            placeholder="Ginning License Number" autocomplete="off"
                            formControlName="ginningLicenseNumber" />
                        </div>


                

                        <div class="col-lg-3 mt-4">
                          <label>Upload Registration Certificate</label><br>
                          <div class="image-input image-input-outline m-1" id="kt_profile_avatar">
                            <img class="image-input-wrapper cursor-pointer"
                              [src]="formGroup.get('ginningCertificate').value? formGroup.get('ginningCertificate')?.value?.includes('.pdf')?'./assets/media/svg/files/pdf.svg': './assets/media/svg/files/jpg.svg' : './assets/media/users/blank.png'"
                              (click)="showImage(formGroup.get('ginningCertificate').value)"
                              style="width: 50px; height: 50px;" />
                            <label class="btn btn-xs btn-icon btn-circle btn-white btn-hover-text-primary btn-shadow"
                              data-action="change" data-toggle="tooltip" title="" data-original-title="Change avatar">
                              <i class="fa fa-pen icon-sm text-muted"></i>
                              <input type="file" name="profile_avatar" (change)="onImageUpload($event);" />
                              <input type="hidden" name="profile_avatar_remove" />
                            </label>
                            <span class="btn btn-xs btn-icon btn-circle btn-white btn-hover-text-primary btn-shadow"
                              data-action="cancel" data-toggle="tooltip" title="" data-original-title="Cancel avatar">
                              <i class="ki ki-bold-close icon-xs text-muted"></i>
                            </span>
                          </div>
                        </div>

                        <!-- <input type="number" class="form-control form-control-lg" name="city"
                            placeholder="City" autocomplete="off" formControlName="ginningCertificate" />
                        </div> -->

                      </div>
                    </ng-template>
                  </ngb-panel>
                </ngb-accordion>
              </div>

              <div class="col-lg-12 mt-6">
                <bank-form [layouttype]="'page'" [productType]="'Cotton'" [customerId]="id" [customerType]="'GINNER_MILL'" [showHideButton]="!verified" [isVerfied]="verified" #bank  (bankVerified)=onBankStatuschange($event)></bank-form>

              </div>

              <!-- <div class="col-lg-12 mt-6">
                <ngb-accordion #acc11="ngbAccordion">
                  <ngb-panel id="toggle-bank">
                    <ng-template ngbPanelTitle>
                      <span class="ard-header--title text-success">Bank Details</span>
                    </ng-template>
                    <ng-template ngbPanelContent>
                      <div formArrayName="bankDetails">

                        <p class="text-warning font-weight-bolder">
                          Please note that the IFSC code for ALLAHABAD BANK (ALLA), SYNDICATE BANK (SYNB),
                          DENA BANK (BKDN) and VIJAYA BANK (VIJB) has been disabled by RBI. Transactions initiated to
                          these IFSCs will be rejected.
                        </p>
                        <div class="row pb-10"
                          *ngFor="let bank of formGroup.get('bankDetails')['controls']; let i=index;"
                          [formGroupName]="i">
  
                          <div class="col-lg-3 mt-2">
                            <label class="form-label">Account Holder’s Name</label>
                            <input type="text" class="form-control form-control-lg"
                              placeholder="Account Holder’s Name" autocomplete="off" formControlName="beneficiaryName" />
                          </div>
  
                          <div class="col-lg-3 mt-2">
                            <label class="form-label">Bank Name</label>
                            <input type="text" class="form-control form-control-lg"
                              placeholder="Bank Name" autocomplete="off" formControlName="bankName" />
                          </div>
  
                          <div class="col-lg-3 mt-2">
                            <label class="form-label">Bank Account Number</label>
                            <input type="text" class="form-control form-control-lg"
                              placeholder="Bank Account Number" autocomplete="off" formControlName="accountNumber">
                          </div>
                          <div class="col-lg-2 mt-2">
                            <label class="form-label">IFSC Code</label>
                            <input type="text" class="form-control form-control-lg"
                              placeholder="IFSC Code" autocomplete="off" formControlName="ifscCode">
                          </div>
                        </div>
                      </div>
                    </ng-template>
                  </ngb-panel>
                </ngb-accordion>
              </div> -->


              <!-- <div class="col-lg-12 mt-6">
                <ngb-accordion #acc11="ngbAccordion">
                  <ngb-panel id="toggle-address">
                    <ng-template ngbPanelTitle>
                      <span class="ard-header--title text-success">KYC Details</span>
                    </ng-template>
                  </ngb-panel>
                </ngb-accordion>
              </div> -->



              <!-- <div class="col-lg-12 mt-6">
                <ngb-accordion #acc11="ngbAccordion">
                  <ngb-panel id="toggle-address">
                    <ng-template ngbPanelTitle>
                      <span class="ard-header--title text-success">Address Details</span>
                    </ng-template>
                    <ng-template ngbPanelContent>
                      <div class="row" [formGroup]="formGroup.get('address')"  >
                        <div class="col-lg-3 mt-2">
                          <label class="form-label">Address</label>
                          <input type="text" class="form-control form-control-lg" name="Address"
                            placeholder="Address" autocomplete="off" formControlName="address" />
                        </div>
                        <div class="col-lg-3 mt-2">
                          <label class="form-label">Village</label>
                          <input type="text" class="form-control form-control-lg" name="Village"
                            placeholder="Village" autocomplete="off" formControlName="village" />
                        </div>
                        <div class="col-lg-3 mt-2">
                          <label class="form-label">City</label>
                          <input type="text" class="form-control form-control-lg" name="city"
                            placeholder="City" autocomplete="off" formControlName="city" />
                        </div>
                        <div class="col-lg-3 mt-2">
                          <label class="form-label">District</label>
                          <input type="text" class="form-control form-control-lg" name="District"
                            placeholder="District" autocomplete="off" formControlName="district" />
                        </div>
                        <div class="col-lg-3 mt-2">
                          <label class="form-label">Taluk</label>
                          <input type="text" class="form-control form-control-lg" name="Taluk"
                            placeholder="Taluk" autocomplete="off" formControlName="taluk" />
                        </div>
                        <div class="col-lg-3 mt-2">
                          <label class="form-label">Region</label>
                          <input type="text" class="form-control form-control-lg" name="region"
                            placeholder="Region" autocomplete="off" formControlName="region" />
                        </div>
                        <div class="col-lg-3 mt-2">
                          <label class="form-label">State</label>
                          <input type="text" class="form-control form-control-lg" name="State"
                            placeholder="State" autocomplete="off" formControlName="state" />
                        </div>
                        <div class="col-lg-3 mt-2">
                          <label class="form-label">PIN Code</label>
                          <input type="text" class="form-control form-control-lg" name="PIN Code"
                            placeholder="PIN Code" autocomplete="off" formControlName="pincode" />
                        </div>
                        <div class="col-lg-3 mt-2">
                          <label class="form-label">Latitude</label>
                          <input type="text" readonly class="form-control form-control-lg" name="PIN Code"
                            placeholder="Latitude" autocomplete="off" formControlName="latitude" />
                        </div>
                        <div class="col-lg-3 mt-2">
                          <label class="form-label">Longitude</label>
                          <input type="text" readonly class="form-control form-control-lg" name="PIN Code"
                            placeholder="Longitude" autocomplete="off" formControlName="longitude" />
                        </div>
                      </div>
                    </ng-template>
                  </ngb-panel>
                </ngb-accordion>
              </div>  -->
              <div class="col-lg-12 mt-6">
                <address-pincode-form [address] [village] [layouttype]="'page'"></address-pincode-form>
                <div class="card-toolbar">
                  <button type="button" class="btn btn-sm btn-secondary mr-2" (click)="goBack();">Back</button>

                  <button type="submit" class="btn btn-sm btn-success" [disabled]="formGroup.invalid"
                    (click)="saveGinnerDetails(formGroup.value)">Save</button>

                </div>
              </div>
            </div>
          </div>
        </div>

      </div>

    </div>
  </div>
</div>



<div class="symbol symbol-50 symbol-light mr-1 cursor-pointer" *ngIf="modelImageUrl" appNoRightClick>

  <!-- The Modal -->
  <div id="reviewModel" class="modal" [ngClass]="{'display-block' : expandImage, 'display-none' : !expandImage}">

    <!-- The Close Button -->
    <span class="close" (click)="expandImage = false">&times;</span>

    <!-- Modal Content (The Image) -->
    <img class="modal-content" *ngIf="!modelImageUrl?.includes('.pdf')" [src]="modelImageUrl">
    <pdf-viewer *ngIf="modelImageUrl?.includes('.pdf')" src="{{modelImageUrl}}"></pdf-viewer>
  </div>
  <!-- </span> -->
</div>